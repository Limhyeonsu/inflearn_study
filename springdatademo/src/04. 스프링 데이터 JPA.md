# 04. 스프링 데이터 JPA

## 1부 핵심 개념 이해
### 9. 1:N 매핑
관계에는 항상 두 엔티티가 존재하고, 둘중 하나는 관계의 주인, 나머지는 종속된 쪽이다.

단방향 관계에서 관계의 주인은 관계를 정의한 쪽이다.
* 단방향 @ManyToOne - 기본값은 `FK` 생성한다.
* 단방향 @OneToMany - 기본값은 `조인 테이블`을 생성한다.
* 양방향 - FK를 가지고 있는쪽이 관계의 주인이다. 주인이 아닌쪽에는 mappedBy를 사용해서 관계의 주인인 필드명을 설정해주어야 한다. 또한 DB에 저장할때 관계의 주인쪽에 관계 매핑을 저장해야 정상적으로 FK가 저장된다. 

예)
```
//study가 관계의 주인, account가 종속
account.getStudies().add(study); //옵션이지만 객체지향적으로 생각했을때 함께 사용하는 것이 좋다.
study.setOwner(account); //필수

//메서드로 만드는 방법도 있음
account.addStudy(study);

class Account {
    //..
    
    public void addStudy(Study study) {
        this.getStudies().add(study);
        study.setOwner(this);
    }
}
```

### 10. Cascade
Cascade는 엔티티의 상태 변화를 전파시키는 옵션이다.

[엔티티 상테]
* Transient : JPA가 모르는 상태
* Persistent : JPA가 관리중인 상태
  * 1차 캐시
  * Dirty Checking : 객체의 변경상태를 계속해서 감지하는 것
  * Write Behind : 객체의 상태 변화를 데이터베이스에 최대한 늦게, 가장 필요한 시점에 적용한다.
* Detached : JPA가 더이상 관리하지 않는 상태
* Removed : JPA가 관리하긴 하지만 삭제하기로 한 상태

Cascade 사용을 하기 위해서는 도메인 관계가 부모-자식 관계가 좋다. account가 사라진다고 해서 study도 사라진다면 부모-자식 관계라고 볼 수 있지만 study는 사라지지 않는다면 부모-자식관계라고 할 수 있다.

### 11. Fetch
연관관계의 엔티티를 가져올때, 
* ~ToMany : 기본값은 Lazy(나중에)
* ~ToOne : 기본값은 Eager(지금)

### 12. Query
* JPQL : DB 테이블이 아닌 엔티티 객체 모델 기반으로 쿼리 작성
* Criteria : 타입 세이프 쿼리
* Native Query : SQL 쿼리 실행

### 13. 스프링 데이터 JPA
interface에 JpaRepository를 extends하면 @Repository를 붙이지 않아도 빈으로 등록해주고, 기본 CRUD 메서드를 제공해줌

빈으로 자동으로 등록해주는 것은 @EnableJpaRepositories 애너테이션을 타고 들어가면 ImportBeanDefinitionRegistrar 인터페이스가 등장하는데 거기서 자동으로 빈을 등록해주고 있다. __@EnableJpaRepositories 애너테이션은 스프링부트에서는 자동으로 해주기 때문에 생략가능__

### 14. 핵심 개념 이해 정리

## 2부 스프링 데이터 JPA 활용

