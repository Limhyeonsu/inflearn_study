# 01. 실전! 스프링부트와 JPA 활용 1

## 1-1. 프로젝트 환경 설정
* 프로젝트 생성
* 라이브러리 살펴보기
* View 환경 설정
* H2 데이터베이스 설치

### JPA와 DB 설정, 동작 확인
[application.yml 설정](https://github.com/Limhyeonsu/inflearn_study/blob/main/jpashop/src/main/resources/application.yml)

스프링 부트를 통해 복잡한 설정이 다 자동화 되어 있다. persistence.xml도 만들 필요가 없다.

쿼리 파라미터 로그 남기는 방법으로 
1) application.yml에 org.hibernate.type: trace로 설정하는 방법
2) 외부 라이브러리를 이용하는 방법 (https://github.com/gavlyukovskiy/spring-boot-data-source-decorator)

## 1-2. 도메인 분석 설계
### 요구사항 분석
### 도메인 모델과 테이블 설계
<img src="img/엔티티분석.png" width="400px">
<img src="img/테이블분석.png" width="400px">

일대다, 다대일의 양방향 관계의 경우 연관관계의 주인을 정해야 한다. 이때 외래 키가 있는 곳을 연관관계 주인으로 정하는 것이 좋다. 연관관계 주인은 단순히 외래 키를 누가 관리하느냐의 문제이지 비즈니스상 우위에 있다고 주인으로 정하면 안 된다.

### 엔티티 클래스 개발1
예제에서는 엔티티 클래스에 Getter, Setter를 모두 사용하지만 실무에서는 Setter는 꼭 필요한 경우에만 사용하는 것을 추천한다.

Item 테이블의 경우 book, album, movie 타입으로 나누어져 있어 공통 부분은 상속관계로 구현한다.
```java
@Entity
@Inheritance(strategy = InheritanceType.SINGLE_TABLE) //상속관계에 해당하는 엔티티 구현시 테이블 하나로 생성하겠다는 설정
@DiscriminatorColumn(name = "dtype") //dtype 컬럼으로 구분하겠다
@Getter
@Setter
public abstract class Item{...}
```
```java
@Entity
@DiscriminatorValue("B") //dtype 지정
@Getter @Setter
public class Book extends Item{...}
```

### 엔티티 클래스 개발2
다대다 관계는 테이블 구조로는 표현할 수 없어 매핑 테이블(Category_Item)이 필요하다. 매핑 테이블을 설정하기 위한 것은 다음과 같다. (실무에서는 다대다 매핑을 사용하지 말자!)
```java
public class Category {
    
    //...

    @ManyToMany
    @JoinTable(name = "category_item",
            joinColumns = @JoinColumn(name = "category_id"),
            inverseJoinColumns = @JoinColumn(name = "item_id"))
    private List<Item> items = new ArrayList<>();
}
```

값 타입 클래스(Address) 설정
```java
//값 타입 클래스는 변경 불가능하게 작성해야 한다. 따라서 Setter는 만들지 않는다.
@Embeddable
@Getter
public class Address {
    private String city;
    private String street;
    private String zipcode;
    
    //JPA 스펙상 엔티티나 임베디드 타입은 자바 기본 생성자를 설정해야 한다.
    protected Address() {
        
    }
    //값 타입의 경우 생성은 생성자로만 한다
    public Address(String city, String street, String zipcode) {
        this.city = city;
        this.street = street;
        this.zipcode = zipcode;
    }
}
```

JPA를 통해 생성된 테이블은 그대로 사용하지 말고 검토 후에 다듬도록 한다.

### 엔티티 설계시 주의점


## 1-3. 애플리케이션 구현 준비